<html>
  <head>
    <title>Homepage</title>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/index.css">
  </head>

  <body>
    <%- include("partials/header") %>

    <% if (user) { %>
      <div class="welcome-banner">
        <h2>üëã Welcome back, <%= user.username || user.email || user.id %>!</h2>
        <% if (user.role === 'ADMIN') { %>
          <p>You are an ADMIN and you can now upload files.</p>
        <% } else if (user.role === 'USER') { %>
          <p>You are a USER and you can see all the uploaded files.</p>
        <% } else { %>
          <p>You are a GUEST. You can't see anything. Log in to continue...</p>
        <% } %>

      </div>

      <% const canSeeUploads = user.role === 'ADMIN' || user.role === 'USER'; %>
      <% if (user.role === 'ADMIN') { %>
        <div class="dashboard-actions">
          <a href="/upload" class="upload-page-btn">Upload Files</a>
        </div>
      <% } %>

      <% if (canSeeUploads && files && files.length) { %>
        <section class="upload-section upload-list">
          <h3>All uploads</h3>
          <table width="100%">
            <thead class="header">
              <tr>
                <th class="download">Action</th>
                <th class="file_name">File name</th>
                <th class="type">Type</th>
                <th class="size">Size</th>
                <th class="added">Added</th>
                <th class="by">By</th>
              </tr>
            </thead>
            <tbody>
              <% files.forEach(file => { %>
                <tr>
                  <td class="action-cell-content">
                    <a href="/download/<%= file.id %>" class="download-action" title="Download">‚¨áÔ∏è</a>
                    <form action="/delete/<%= file.id %>" method="POST" class="inline-action">
                      <button type="submit" class="delete-action" onclick="return confirm('Delete file?')" title="Delete">‚úñ</button>
                    </form>
                  </td>
                  <td><%= file.filename %></td>
                  <td><%= file.type %></td>
                  <td><%= file.displaySize || '‚Äî' %></td>
                  <td>
                    <%= file.addedAt
                      ? file.addedAt.toLocaleString('fr-FR', {
                          day: '2-digit',
                          month: '2-digit',
                          year: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })
                      : '‚Äî' %>
                  </td>
                  <td>#<%= file.userId %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </section>
      <% } else if (canSeeUploads) { %>
        <section class="upload-section upload-list">
          <p>No files uploaded yet.</p>
        </section>
      <% } %>


    <% } else { %>
      <div class="not-logged-in">
        üëã Hello visitor! You are not logged in !
      </div>

      <%- include("partials/login-form") %>
      
    <% } %>
  </body>
</html>
